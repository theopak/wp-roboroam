(function(d){d.fn.pjax=function(e,f){if(f){f.container=e}else{f=d.isPlainObject(e)?e:{container:e}}if(f.container&&typeof f.container!=="string"){throw"pjax container must be a string selector!";return false}return this.live("click",function(g){if(g.which>1||g.metaKey){return true}var h={url:this.href,container:d(this).attr("data-pjax"),clickedElement:d(this),fragment:null};d.pjax(d.extend({},h,f));g.preventDefault()})};var c=d.pjax=function(e){var h=d(e.container),g=e.success||d.noop;delete e.success;if(typeof e.container!=="string"){throw"pjax container must be a string selector!"}e=d.extend(true,{},c.defaults,e);if(d.isFunction(e.url)){e.url=e.url()}e.context=h;e.success=function(l){if(e.fragment){var o=d(l).find(e.fragment);if(o.length){l=o.children()}else{return window.location=e.url}}else{if(!d.trim(l)||/<html/i.test(l)){return window.location=e.url}}this.html(l);var i=document.title,n=d.trim(this.find("title").remove().text());if(n){document.title=n}if(!n&&e.fragment){n=o.attr("title")||o.data("title")}var k={pjax:e.container,fragment:e.fragment,timeout:e.timeout};var j=d.param(e.data);if(j!="_pjax=true"){k.url=e.url+(/\?/.test(e.url)?"&":"?")+j}if(e.replace){window.history.replaceState(k,document.title,e.url)}else{if(e.push){if(!c.active){window.history.replaceState(d.extend({},k,{url:null}),i);c.active=true}window.history.pushState(k,document.title,e.url)}}if((e.replace||e.push)&&window._gaq){_gaq.push(["_trackPageview"])}var m=window.location.hash.toString();if(m!==""){window.location.href=m}g.apply(this,arguments)};var f=c.xhr;if(f&&f.readyState<4){f.onreadystatechange=d.noop;f.abort()}c.options=e;c.xhr=d.ajax(e);d(document).trigger("pjax",[c.xhr,e]);return c.xhr};c.defaults={timeout:650,push:true,replace:false,data:{_pjax:true},type:"GET",dataType:"html",beforeSend:function(e){this.trigger("pjax:start",[e,c.options]);this.trigger("start.pjax",[e,c.options]);e.setRequestHeader("X-PJAX","true")},error:function(f,g,e){if(g!=="abort"){window.location=c.options.url}},complete:function(e){this.trigger("pjax:end",[e,c.options]);this.trigger("end.pjax",[e,c.options])}};var b=("state" in window.history),a=location.href;d(window).bind("popstate",function(g){var f=!b&&location.href==a;b=true;if(f){return}var h=g.state;if(h&&h.pjax){var e=h.pjax;if(d(e+"").length){d.pjax({url:h.url||location.href,fragment:h.fragment,container:e,push:false,timeout:h.timeout})}else{window.location=location.href}}});if(d.inArray("state",d.event.props)<0){d.event.props.push("state")}d.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/(iPod|iPhone|iPad|WebApps\/.+CFNetwork)/);if(!d.support.pjax){d.pjax=function(e){window.location=d.isFunction(e.url)?e.url():e.url};d.fn.pjax=function(){return this}}})(jQuery);